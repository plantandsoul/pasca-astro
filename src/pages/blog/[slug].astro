---
import BlocksRenderer from '../../components/BlocksRenderer';
import DevModeArea from '../../components/DevModeArea.astro';
import PageLayout from '../../layouts/PageLayout.astro';
import { pascaApiClient } from '../../lib/strapi';

export async function getStaticPaths() {
  const posts = await pascaApiClient.posts.getPosts({ populate: '*' })
    .then(response => response.data.data || [])
    .catch(() => [])
  ;

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
};

const post = Astro.props;
---

<PageLayout title="blog">
  <DevModeArea>{JSON.stringify(post, null, 2)}</DevModeArea>
  <h1>{post.title}</h1>
  <BlocksRenderer blocks={post.blocks || []} />
</PageLayout>
